# Example values for deploying mcp-kubernetes with Dex OIDC authentication
# This is a YAML-formatted file showing how to configure Dex OAuth.

# Ingress is typically required for OAuth to work properly
# as OAuth needs a publicly accessible URL
ingress:
  enabled: true
  className: "nginx"
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # Add any other annotations needed for your ingress
  hosts:
    - host: mcp-k8s.example.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: mcp-k8s-tls
      hosts:
        - mcp-k8s.example.com

# MCP Kubernetes specific configuration
mcpKubernetes:
  # Kubernetes configuration
  kubernetes:
    # Use in-cluster configuration when deployed in Kubernetes
    inCluster: true
  
  # OAuth 2.1 configuration
  oauth:
    # Enable OAuth 2.1 authentication
    enabled: true
    
    # OAuth provider - use "dex" for Dex OIDC
    provider: "dex"
    
    # OAuth base URL - MUST match your ingress host
    # This is used for OAuth callbacks and metadata endpoints
    baseURL: "https://mcp-k8s.example.com"
    
    # Dex OIDC configuration
    dex:
      # Dex issuer URL - the OIDC discovery endpoint
      issuerURL: "https://dex.example.com"
      
      # Dex OAuth Client ID
      clientID: "mcp-kubernetes"
      
      # Dex OAuth Client Secret
      # OPTION 1: Use values directly (NOT RECOMMENDED for production)
      # Only use this for testing/development
      # clientSecret: "your-dex-client-secret"
      
      # OPTION 2: Use an existing secret (RECOMMENDED for production)
      # The secret is referenced via existingSecret below
      # clientSecret is read from the secret
      
      # Optional: Dex connector ID to bypass connector selection screen
      # If your Dex has multiple connectors (GitHub, LDAP, etc.), setting this
      # will automatically use the specified connector for better UX
      # connectorID: "github"
    
    # OPTION 2: Use an existing secret (RECOMMENDED for production)
    # Create the secret with:
    # kubectl create secret generic mcp-k8s-oauth-credentials \
    #   --from-literal=dex-client-secret=YOUR_DEX_CLIENT_SECRET \
    #   --from-literal=registration-token=YOUR_REGISTRATION_TOKEN \
    #   --from-literal=oauth-encryption-key=$(openssl rand -base64 32)
    existingSecret: "mcp-k8s-oauth-credentials"
    
    # Security settings
    allowPublicRegistration: false  # Require registration token (recommended)
    disableStreaming: false          # Enable streaming by default
    encryptionKey: true              # Enable token encryption at rest (recommended)
    
    # Enable downstream OAuth for Kubernetes API authentication
    # When enabled, user OAuth tokens are used for Kubernetes API calls
    # Requires the Kubernetes cluster to be configured with Dex OIDC authentication
    # enableDownstreamOAuth: true
  
  # Additional environment variables (if needed)
  env: []

# Resources - increase for production workloads
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 200m
    memory: 256Mi

# Enable horizontal pod autoscaling for production
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80






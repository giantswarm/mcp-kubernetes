{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "replicaCount": {
      "type": "integer",
      "minimum": 1
    },
    "image": {
      "type": "object",
      "properties": {
        "registry": {
          "type": "string"
        },
        "repository": {
          "type": "string"
        },
        "pullPolicy": {
          "type": "string",
          "enum": ["Always", "Never", "IfNotPresent"]
        },
        "tag": {
          "type": "string"
        }
      },
      "required": ["registry", "repository", "pullPolicy"]
    },
    "imagePullSecrets": {
      "type": "array",
      "items": {
        "type": "object"
      }
    },
    "nameOverride": {
      "type": "string"
    },
    "fullnameOverride": {
      "type": "string"
    },
    "serviceAccount": {
      "type": "object",
      "properties": {
        "create": {
          "type": "boolean"
        },
        "automount": {
          "type": "boolean"
        },
        "annotations": {
          "type": "object"
        },
        "name": {
          "type": "string"
        }
      }
    },
    "rbac": {
      "type": "object",
      "description": "RBAC configuration for the ServiceAccount",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Create RBAC resources (ClusterRole and ClusterRoleBinding)"
        },
        "profile": {
          "type": "string",
          "description": "RBAC profile: minimal (no permissions), readonly (read-only, no secrets), standard (read/write including secrets), admin (requires adminConfirmation)",
          "enum": ["minimal", "readonly", "standard", "admin"]
        },
        "adminConfirmation": {
          "type": "boolean",
          "description": "REQUIRED when using admin profile. Must be set to true to acknowledge the dangerous permissions (RBAC management, pod exec, webhook configuration)"
        },
        "custom": {
          "type": "object",
          "description": "Custom RBAC rules. WARNING: Overrides profile safety controls when enabled - use with caution",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable custom RBAC rules"
            },
            "rules": {
              "type": "array",
              "description": "Custom RBAC rules to apply",
              "items": {
                "type": "object",
                "properties": {
                  "apiGroups": {
                    "type": "array",
                    "items": {"type": "string"}
                  },
                  "resources": {
                    "type": "array",
                    "items": {"type": "string"}
                  },
                  "verbs": {
                    "type": "array",
                    "items": {"type": "string"}
                  }
                },
                "required": ["apiGroups", "resources", "verbs"]
              }
            }
          }
        }
      }
    },
    "podAnnotations": {
      "type": "object"
    },
    "podLabels": {
      "type": "object"
    },
    "podSecurityContext": {
      "type": "object",
      "properties": {
        "runAsUser": {
          "type": "integer"
        },
        "runAsGroup": {
          "type": "integer"
        },
        "runAsNonRoot": {
          "type": "boolean"
        },
        "fsGroup": {
          "type": "integer"
        }
      }
    },
    "securityContext": {
      "type": "object",
      "properties": {
        "readOnlyRootFilesystem": {
          "type": "boolean"
        },
        "allowPrivilegeEscalation": {
          "type": "boolean"
        },
        "runAsUser": {
          "type": "integer"
        },
        "runAsGroup": {
          "type": "integer"
        },
        "runAsNonRoot": {
          "type": "boolean"
        },
        "seccompProfile": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string"
            }
          }
        },
        "capabilities": {
          "type": "object",
          "properties": {
            "drop": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "service": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["ClusterIP", "NodePort", "LoadBalancer", "ExternalName"]
        },
        "port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535
        }
      },
      "required": ["type", "port"]
    },
    "ingress": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "className": {
          "type": "string"
        },
        "annotations": {
          "type": "object"
        },
        "hosts": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "host": {
                "type": "string"
              },
              "paths": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "path": {
                      "type": "string"
                    },
                    "pathType": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        },
        "tls": {
          "type": "array"
        }
      }
    },
    "resources": {
      "type": "object"
    },
    "autoscaling": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "minReplicas": {
          "type": "integer",
          "minimum": 1
        },
        "maxReplicas": {
          "type": "integer",
          "minimum": 1
        },
        "targetCPUUtilizationPercentage": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100
        },
        "targetMemoryUtilizationPercentage": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100
        }
      }
    },
    "volumes": {
      "type": "array"
    },
    "volumeMounts": {
      "type": "array"
    },
    "nodeSelector": {
      "type": "object"
    },
    "tolerations": {
      "type": "array"
    },
    "affinity": {
      "type": "object"
    },
    "mcpKubernetes": {
      "type": "object",
      "properties": {
        "kubernetes": {
          "type": "object",
          "properties": {
            "inCluster": {
              "type": "boolean"
            },
            "kubeconfig": {
              "type": "string"
            }
          }
        },
        "oauth": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "baseURL": {
              "type": "string"
            },
            "googleClientID": {
              "type": "string"
            },
            "googleClientSecret": {
              "type": "string"
            },
            "registrationToken": {
              "type": "string"
            },
            "registrationAccessToken": {
              "type": "string"
            },
            "allowPublicRegistration": {
              "type": "boolean"
            },
            "allowInsecureAuthWithoutState": {
              "type": "boolean"
            },
            "allowPrivateURLs": {
              "type": "boolean",
              "description": "Allow OAuth URLs that resolve to private/internal IP addresses (for internal deployments)"
            },
            "maxClientsPerIP": {
              "type": "integer"
            },
            "encryptionKey": {
              "type": "boolean"
            },
            "encryptionKeyValue": {
              "type": "string"
            },
            "disableStreaming": {
              "type": "boolean"
            },
            "existingSecret": {
              "type": "string"
            },
            "provider": {
              "type": "string",
              "enum": ["dex", "google"],
              "description": "OAuth provider: dex or google"
            },
            "dex": {
              "type": "object",
              "description": "Dex OIDC provider configuration",
              "properties": {
                "issuerURL": {
                  "type": "string",
                  "description": "Dex OIDC issuer URL"
                },
                "clientID": {
                  "type": "string",
                  "description": "Dex OAuth Client ID"
                },
                "clientSecret": {
                  "type": "string",
                  "description": "Dex OAuth Client Secret"
                },
                "connectorID": {
                  "type": "string",
                  "description": "Dex connector ID to bypass connector selection screen"
                },
                "kubernetesAuthenticatorClientID": {
                  "type": "string",
                  "description": "Kubernetes authenticator client ID for cross-client audience tokens"
                },
                "caSecret": {
                  "type": "object",
                  "description": "CA certificate secret for Dex TLS verification",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "key": {
                      "type": "string"
                    }
                  }
                }
              }
            },
            "enableDownstreamOAuth": {
              "type": "boolean",
              "description": "Enable downstream OAuth token passthrough to Kubernetes API"
            },
            "redirectURISecurity": {
              "type": "object",
              "description": "Redirect URI security configuration. All settings default to secure values.",
              "properties": {
                "disableProductionMode": {
                  "type": "boolean",
                  "description": "Disable production mode (allows HTTP, private IPs). WARNING: Significantly weakens security."
                },
                "allowLocalhostRedirectURIs": {
                  "type": "boolean",
                  "description": "Allow http://localhost redirect URIs for native apps (RFC 8252)"
                },
                "allowPrivateIPRedirectURIs": {
                  "type": "boolean",
                  "description": "Allow private IP addresses (10.x, 172.16.x, 192.168.x) in redirect URIs. WARNING: SSRF risk."
                },
                "allowLinkLocalRedirectURIs": {
                  "type": "boolean",
                  "description": "Allow link-local addresses (169.254.x.x) in redirect URIs. WARNING: Cloud metadata SSRF risk."
                },
                "disableDNSValidation": {
                  "type": "boolean",
                  "description": "Disable DNS validation of redirect URI hostnames. WARNING: Allows DNS rebinding attacks."
                },
                "disableDNSValidationStrict": {
                  "type": "boolean",
                  "description": "Disable fail-closed DNS validation. WARNING: Allows validation bypass via DNS failures."
                },
                "disableAuthorizationTimeValidation": {
                  "type": "boolean",
                  "description": "Disable redirect URI validation at authorization time. WARNING: Allows TOCTOU attacks."
                }
              }
            },
            "trustedPublicRegistrationSchemes": {
              "type": "array",
              "description": "URI schemes allowed for unauthenticated client registration (e.g., cursor, vscode). Enables MCP clients that don't support registration tokens.",
              "items": {
                "type": "string"
              }
            },
            "disableStrictSchemeMatching": {
              "type": "boolean",
              "description": "Allow mixed redirect URI schemes with trusted scheme registration. WARNING: Reduces security."
            }
          }
        },
        "env": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "value": {
                "type": "string"
              }
            },
            "required": ["name"]
          }
        },
        "metrics": {
          "type": "object",
          "description": "Metrics server configuration. Runs on a separate port for security.",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable the dedicated metrics server (default: true)"
            },
            "port": {
              "type": "integer",
              "description": "Port for the metrics server (default: 9090)",
              "minimum": 1,
              "maximum": 65535
            }
          }
        }
      }
    },
    "capiMode": {
      "type": "object",
      "description": "CAPI Mode configuration for multi-cluster federation",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable CAPI federation mode"
        },
        "cache": {
          "type": "object",
          "description": "Client cache settings for workload cluster connections",
          "properties": {
            "ttl": {
              "type": "string",
              "description": "Time-to-live for cached clients (e.g., '10m')",
              "pattern": "^[0-9]+(s|m|h)$"
            },
            "maxEntries": {
              "type": "integer",
              "description": "Maximum number of cached (cluster, user) pairs",
              "minimum": 1,
              "maximum": 10000
            },
            "cleanupInterval": {
              "type": "string",
              "description": "How often to clean up expired entries (e.g., '1m')",
              "pattern": "^[0-9]+(s|m|h)$"
            }
          }
        },
        "connectivity": {
          "type": "object",
          "description": "Connectivity settings for workload clusters",
          "properties": {
            "timeout": {
              "type": "string",
              "description": "Timeout for initial TCP connection (e.g., '5s')",
              "pattern": "^[0-9]+(s|m|h)$"
            },
            "retryAttempts": {
              "type": "integer",
              "description": "Number of retry attempts for transient failures",
              "minimum": 0,
              "maximum": 10
            },
            "retryBackoff": {
              "type": "string",
              "description": "Initial backoff between retries (e.g., '1s')",
              "pattern": "^[0-9]+(s|m|h)$"
            },
            "requestTimeout": {
              "type": "string",
              "description": "Request timeout for API operations (e.g., '30s')",
              "pattern": "^[0-9]+(s|m|h)$"
            },
            "qps": {
              "type": "integer",
              "description": "QPS rate limit for Kubernetes client",
              "minimum": 1,
              "maximum": 1000
            },
            "burst": {
              "type": "integer",
              "description": "Burst limit for Kubernetes client",
              "minimum": 1,
              "maximum": 2000
            }
          }
        },
        "output": {
          "type": "object",
          "description": "Output processing limits for fleet-scale operations",
          "properties": {
            "maxItems": {
              "type": "integer",
              "description": "Maximum items per query (absolute max: 1000)",
              "minimum": 1,
              "maximum": 1000
            },
            "maxClusters": {
              "type": "integer",
              "description": "Maximum clusters in fleet-wide queries (absolute max: 100)",
              "minimum": 1,
              "maximum": 100
            },
            "maxResponseBytes": {
              "type": "integer",
              "description": "Maximum response size in bytes (absolute max: 2MB)",
              "minimum": 1024,
              "maximum": 2097152
            },
            "slimOutput": {
              "type": "boolean",
              "description": "Enable slim output (removes verbose fields)"
            },
            "maskSecrets": {
              "type": "boolean",
              "description": "Mask secret data with ***REDACTED***"
            }
          }
        },
        "rbac": {
          "type": "object",
          "description": "RBAC configuration for CAPI mode",
          "properties": {
            "create": {
              "type": "boolean",
              "description": "Create CAPI-specific RBAC resources"
            },
            "allowedNamespaces": {
              "type": "array",
              "description": "Namespaces to grant kubeconfig secret access",
              "items": {
                "type": "string"
              }
            },
            "clusterWideSecrets": {
              "type": "boolean",
              "description": "Grant cluster-wide secret access (NOT recommended)"
            }
          }
        }
      }
    },
    "ciliumNetworkPolicy": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean"
        },
        "labels": {
          "type": "object"
        },
        "annotations": {
          "type": "object"
        }
      },
      "required": ["enabled"]
    }
  },
  "required": [
    "replicaCount",
    "image",
    "serviceAccount",
    "service",
    "mcpKubernetes",
    "ciliumNetworkPolicy"
  ]
}
